/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{383:function(ha,ca,f){f.r(ca);var aa=f(2),y=f(12),fa=f(1);ha=f(45);var da=f(26),ba=f(11);f=function(){function f(){this.init()}f.prototype.init=function(){this.S0=!1;this.$f=this.jk=this.connection=null;this.yq={};this.ea=this.rC=null};f.prototype.Tea=function(f){for(var r=this,e=0;e<f.length;++e){var h=f[e];switch(h.at){case "create":this.yq[h.author]||(this.yq[h.author]=h.aName);this.F7(h);break;case "modify":this.ea.Dm(h.xfdf).then(function(e){r.ea.Ab(e[0])});
break;case "delete":this.ea.Dm("<delete><id>"+h.aId+"</id></delete>")}}};f.prototype.F7=function(f){var r=this;this.ea.Dm(f.xfdf).then(function(e){e=e[0];e.authorId=f.author;r.ea.Ab(e);r.ea.trigger(y.a.UPDATE_ANNOTATION_PERMISSION,[e])})};f.prototype.h7=function(f,r,e){this.jk&&this.jk(f,r,e)};f.prototype.preloadAnnotations=function(f){this.addEventListener("webViewerServerAnnotationsEnabled",this.h7.bind(this,f,"add",{imported:!1}),{once:!0})};f.prototype.initiateCollaboration=function(w,r,e){var h=
this;if(w){h.$f=r;h.ea=e.ua();e.addEventListener(y.c.DOCUMENT_UNLOADED,function(){h.disableCollaboration()});h.sfa(w);var n=new XMLHttpRequest;n.addEventListener("load",function(){if(200===n.status&&0<n.responseText.length)try{var e=JSON.parse(n.responseText);h.connection=exports.kb.Tfa(Object(da.j)(h.$f,"blackbox/"),"annot");h.rC=e.id;h.yq[e.id]=e.user_name;h.ea.ZI(e.id);h.connection.CJ(function(e){e.t&&e.t.startsWith("a_")&&e.data&&h.Tea(e.data)},function(){h.connection.send({t:"a_retrieve",dId:w});
h.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[h.yq[e.id],h.rC])},function(){h.disableCollaboration()})}catch(ja){Object(fa.f)(ja.message)}});n.open("GET",Object(da.j)(this.$f,"demo/SessionInfo.jsp"));n.withCredentials=!0;n.send();h.S0=!0;h.ea.hU(function(e){return h.yq[e.Author]||e.Author})}else Object(fa.f)("Document ID required for collaboration")};f.prototype.disableCollaboration=function(){this.jk&&(this.ea.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.jk),this.jk=null);this.connection&&
this.connection.qF();this.ea&&this.ea.ZI("Guest");this.init();this.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};f.prototype.sfa=function(f){var r=this;this.jk&&this.ea.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.jk);this.jk=function(e,h,n){return Object(aa.b)(this,void 0,void 0,function(){var w,x,y,ba,da,ca,fa,ha,oa;return Object(aa.d)(this,function(z){switch(z.label){case 0:if(n.imported)return[2];w={t:"a_"+h,dId:f,annots:[]};return[4,r.ea.VO()];case 1:x=z.ga();"delete"!==
h&&(y=(new DOMParser).parseFromString(x,"text/xml"),ba=new XMLSerializer);for(da=0;da<e.length;da++)ca=e[da],ha=fa=void 0,"add"===h?(fa=y.querySelector('[name="'+ca.Id+'"]'),ha=ba.serializeToString(fa),oa=null,ca.InReplyTo&&(oa=r.ea.rg(ca.InReplyTo).authorId||"default"),w.annots.push({at:"create",aId:ca.Id,author:r.rC,aName:r.yq[r.rC],parent:oa,xfdf:"<add>"+ha+"</add>"})):"modify"===h?(fa=y.querySelector('[name="'+ca.Id+'"]'),ha=ba.serializeToString(fa),w.annots.push({at:"modify",aId:ca.Id,xfdf:"<modify>"+
ha+"</modify>"})):"delete"===h&&w.annots.push({at:"delete",aId:ca.Id});0<w.annots.length&&r.connection.send(w);return[2]}})})}.bind(r);this.ea.addEventListener(ba.a.Events.ANNOTATION_CHANGED,this.jk)};f.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return f}();Object(ha.a)(f);ca["default"]=f}}]);}).call(this || window)
